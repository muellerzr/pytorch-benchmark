---

title: PyTorch Preprocessors


keywords: fastai
sidebar: home_sidebar

summary: "Module for preprocessing torch classes to prepare for various distributed environments"
description: "Module for preprocessing torch classes to prepare for various distributed environments"
nb_path: "nbs/01_prepare.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/01_prepare.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>This module is what is essentially a barebones version of <a href="https://github.com/huggingface/accelerate">Accelerate</a> but it only affects the outer-most layer of the modules for what is needed in these tests.</p>
<p>So for example dispatched dataloaders are not a part of this, nor affecting the underlying dataset.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Preprocessors">Preprocessors<a class="anchor-link" href="#Preprocessors"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="prepare_model" class="doc_header"><code>prepare_model</code><a href="https://github.com/muellerzr/pytorch-benchmark/pytorch_benchmark/prepare.py#L20" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>prepare_model</code>(<strong><code>model</code></strong>:<code>Module</code>, <strong>**<code>kwargs</code></strong>)</p>
</blockquote>
<p>Prepares a model for distributed training. kwargs are sent to DDP</p>
<table>
<thead><tr>
<th></th>
<th>Type</th>
<th>Default</th>
<th>Details</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong><code>model</code></strong></td>
<td><code>Module</code></td>
<td></td>
<td>A PyTorch model to wrap</td>
</tr>
<tr>
<td><strong><code>kwargs</code></strong></td>
<td></td>
<td></td>
<td><em>No Content</em></td>
</tr>
</tbody>
</table>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="prepare_optimizer" class="doc_header"><code>prepare_optimizer</code><a href="https://github.com/muellerzr/pytorch-benchmark/pytorch_benchmark/prepare.py#L72" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>prepare_optimizer</code>(<strong><code>opt</code></strong>:<code>Optimizer</code>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="prepare_scheduler" class="doc_header"><code>prepare_scheduler</code><a href="https://github.com/muellerzr/pytorch-benchmark/pytorch_benchmark/prepare.py#L91" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>prepare_scheduler</code>(<strong><code>sched</code></strong>:<code>_LRScheduler</code>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="prepare_modules" class="doc_header"><code>prepare_modules</code><a href="https://github.com/muellerzr/pytorch-benchmark/pytorch_benchmark/prepare.py#L115" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>prepare_modules</code>(<strong>*<code>modules</code></strong>)</p>
</blockquote>
<p>Prepares a set of modules, supports only PyTorch models, optimizers, and schedulers</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Interfaces">Interfaces<a class="anchor-link" href="#Interfaces"> </a></h2><p>The interface classes <a href="/pytorch-benchmark/prepare.html#prepare_modules"><code>prepare_modules</code></a> may wrap around</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="OptimizerInterface" class="doc_header"><code>class</code> <code>OptimizerInterface</code><a href="https://github.com/muellerzr/pytorch-benchmark/pytorch_benchmark/prepare.py#L32" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>OptimizerInterface</code>(<strong><code>optimizer</code></strong>) :: <code>Optimizer</code></p>
</blockquote>
<p>Basic optimizer wrapper that performs the right step call for TPU</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="OptimizerInterface.state_dict" class="doc_header"><code>OptimizerInterface.state_dict</code><a href="https://github.com/muellerzr/pytorch-benchmark/pytorch_benchmark/prepare.py#L57" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>OptimizerInterface.state_dict</code>()</p>
</blockquote>
<p>Passthrough to state dict</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="OptimizerInterface.step" class="doc_header"><code>OptimizerInterface.step</code><a href="https://github.com/muellerzr/pytorch-benchmark/pytorch_benchmark/prepare.py#L65" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>OptimizerInterface.step</code>(<strong><code>closure</code></strong>=<em><code>None</code></em>)</p>
</blockquote>
<p>Passthrough unless on TPU then calls the right stepper</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="OptimizerInterface.zero_grad" class="doc_header"><code>OptimizerInterface.zero_grad</code><a href="https://github.com/muellerzr/pytorch-benchmark/pytorch_benchmark/prepare.py#L61" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>OptimizerInterface.zero_grad</code>()</p>
</blockquote>
<p>Passthrough to zero_grad</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="SchedulerInterface" class="doc_header"><code>class</code> <code>SchedulerInterface</code><a href="https://github.com/muellerzr/pytorch-benchmark/pytorch_benchmark/prepare.py#L78" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>SchedulerInterface</code>(<strong><code>scheduler</code></strong>, <strong><code>num_processes</code></strong>)</p>
</blockquote>
<p>Wrapper to step the scheduler the right number of times</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="SchedulerInterface.step" class="doc_header"><code>SchedulerInterface.step</code><a href="https://github.com/muellerzr/pytorch-benchmark/pytorch_benchmark/prepare.py#L84" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>SchedulerInterface.step</code>(<strong>*<code>args</code></strong>, <strong>**<code>kwargs</code></strong>)</p>
</blockquote>
<p>Passthrough to <code>scheduler.step</code> but will also step the right number of times</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

</div>
 

